{% extends "base.html" %} {% block title %}Danh s√°ch Flashcards - Learn
English{% endblock %} {% block content %}
<div class="flashcard-list-page">
  <div class="page-header">
    <h1>üìö Danh s√°ch Flashcards</h1>
    <p>T·ªïng c·ªông {{ flashcard_defs|length }} t·ª´ v·ª±ng</p>
    <div class="header-actions">
      <a href="{% url 'add_flashcard' %}" class="btn-add">
        <span>‚ûï</span>
        Th√™m t·ª´ m·ªõi
      </a>
    </div>
  </div>

  {% if flashcard_defs %}
  <div class="flashcards-grid">
    {% for card, definitions in flashcard_defs %}
    <div class="flashcard-card" data-id="{{ card.id }}">
      <button
        class="delete-flashcard-btn"
        data-id="{{ card.id }}"
        title="X√≥a flashcard"
      >
        ‚úñ
      </button>

      <div class="card-header">
        <h3 class="card-word">{{ card.word }}</h3>
        {% if card.part_of_speech %}
        <span class="card-pos">{{ card.part_of_speech }}</span>
        {% endif %}
      </div>

      {% if card.image %}
      <div class="card-image">
        <img src="{{ card.image.url }}" alt="·∫¢nh minh h·ªça {{ card.word }}" />
      </div>
      {% endif %}

      <div class="card-content">
        <div class="audio-section">
          {% if card.audio_url %}
          <button
            class="play-audio"
            data-audio="{{ card.audio_url }}"
            title="Nghe ph√°t √¢m"
          >
            üîä Nghe ph√°t √¢m
          </button>
          {% else %}
          <span class="no-audio">üîá Kh√¥ng c√≥ audio</span>
          {% endif %}
        </div>

        <div class="definitions">
          <h4>ƒê·ªãnh nghƒ©a:</h4>
          {% for definition in definitions %}
          <div class="definition-item">
            <div class="def-en">
              <strong>EN:</strong> {{ definition.english_definition }}
            </div>
            {% if definition.vietnamese_definition %}
            <div class="def-vi">
              <strong>VI:</strong> {{ definition.vietnamese_definition }}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="card-footer">
        <div class="created-at" data-utc="{{ card.created_at|date:'c' }}"></div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">üìñ</div>
    <h2>Ch∆∞a c√≥ flashcard n√†o</h2>
    <p>H√£y b·∫Øt ƒë·∫ßu th√™m t·ª´ v·ª±ng ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
    <a href="{% url 'add_flashcard' %}" class="btn-primary">
      ‚ûï Th√™m t·ª´ v·ª±ng ƒë·∫ßu ti√™n
    </a>
  </div>
  {% endif %}
</div>

<style>
  .flashcard-list-page {
    max-width: 1200px;
    margin: 0 auto;
  }

  .page-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px 0;
    border-bottom: 1px solid #3a3a5c;
  }

  .page-header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .page-header p {
    color: #b0b0b0;
    font-size: 1.1em;
    margin-bottom: 20px;
  }

  .header-actions {
    margin-top: 20px;
  }

  .btn-add {
    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    transition: transform 0.3s ease;
  }

  .btn-add:hover {
    transform: translateY(-2px);
  }

  .flashcards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
  }

  .flashcard-card {
    background: #232345;
    border: 1px solid #3a3a5c;
    border-radius: 15px;
    padding: 25px;
    position: relative;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .flashcard-card:hover {
    transform: translateY(-5px);
    border-color: #667eea;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
  }

  .delete-flashcard-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #ff5252;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 14px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 10;
  }

  .flashcard-card:hover .delete-flashcard-btn {
    opacity: 1;
  }

  .delete-flashcard-btn:hover {
    background: #f44336;
  }

  .card-header {
    margin-bottom: 20px;
  }

  .card-word {
    font-size: 1.8em;
    font-weight: bold;
    color: #fff;
    margin: 0 0 8px 0;
  }

  .card-pos {
    background: #667eea;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-style: italic;
  }

  .card-image {
    margin-bottom: 20px;
    text-align: center;
  }

  .card-image img {
    max-width: 100%;
    max-height: 150px;
    border-radius: 8px;
    object-fit: cover;
  }

  .audio-section {
    margin-bottom: 20px;
  }

  .play-audio {
    background: #667eea;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background 0.3s ease;
  }

  .play-audio:hover {
    background: #764ba2;
  }

  .no-audio {
    color: #888;
    font-size: 0.9em;
  }

  .definitions h4 {
    color: #b0b0b0;
    margin-bottom: 15px;
    font-size: 1em;
  }

  .definition-item {
    background: #1a1a2e;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    border-left: 3px solid #667eea;
  }

  .def-en,
  .def-vi {
    margin-bottom: 8px;
    line-height: 1.5;
  }

  .def-en strong,
  .def-vi strong {
    color: #667eea;
  }

  .card-footer {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #3a3a5c;
  }

  .created-at {
    color: #888;
    font-size: 0.85em;
    text-align: center;
  }

  .empty-state {
    text-align: center;
    padding: 80px 20px;
    background: #232345;
    border-radius: 15px;
    margin: 40px 0;
  }

  .empty-icon {
    font-size: 4em;
    margin-bottom: 20px;
  }

  .empty-state h2 {
    color: #fff;
    margin-bottom: 15px;
  }

  .empty-state p {
    color: #b0b0b0;
    margin-bottom: 30px;
    font-size: 1.1em;
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 30px;
    border-radius: 8px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    transition: transform 0.3s ease;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
  }

  @media (max-width: 768px) {
    .flashcards-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .page-header h1 {
      font-size: 2em;
    }
  }
</style>

<script>
  // Format ng√†y t·∫°o
  document.querySelectorAll(".created-at").forEach(function (div) {
    const utc = div.getAttribute("data-utc");
    if (utc) {
      const localDate = new Date(utc);
      const pad = (n) => (n < 10 ? "0" + n : n);
      const str =
        pad(localDate.getDate()) +
        "/" +
        pad(localDate.getMonth() + 1) +
        "/" +
        localDate.getFullYear() +
        " " +
        pad(localDate.getHours()) +
        ":" +
        pad(localDate.getMinutes());
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
      div.textContent = "T·∫°o l√∫c: " + str;
    }
  });

  // Play audio function
  document.querySelectorAll(".play-audio").forEach((btn) => {
    btn.addEventListener("click", function () {
      const audioUrl = this.getAttribute("data-audio");
      if (audioUrl) {
        const audio = new Audio(audioUrl);
        audio.play().catch((e) => {
          console.error("Kh√¥ng th·ªÉ ph√°t audio:", e);
          alert("Kh√¥ng th·ªÉ ph√°t audio n√†y");
        });
      }
    });
  });

  // Delete flashcard function
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  document.querySelectorAll(".delete-flashcard-btn").forEach((btn) => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();

      if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a flashcard n√†y kh√¥ng?")) return;

      const cardId = this.getAttribute("data-id");
      const cardElement = this.closest(".flashcard-card");

      fetch("/api/delete-flashcard/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie("csrftoken"),
        },
        body: JSON.stringify({ id: cardId }),
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            cardElement.style.transform = "scale(0)";
            cardElement.style.opacity = "0";
            setTimeout(() => {
              cardElement.remove();
              // Check if no cards left
              if (document.querySelectorAll(".flashcard-card").length === 0) {
                location.reload();
              }
            }, 300);
          } else {
            alert(
              "L·ªói khi x√≥a flashcard: " + (data.error || "Kh√¥ng r√µ nguy√™n nh√¢n")
            );
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("ƒê√£ x·∫£y ra l·ªói khi x√≥a flashcard");
        });
    });
  });
</script>
{% endblock %}
