{% extends "base.html" %}
{% load static %}
{% block title %}{{ manual_texts.study }} - {{ manual_texts.learn_english }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/study.css' %}">
{% endblock %}

{% block content %}
<div class="study-page">
  <div class="study-header">
    <h1 class="study-title">📖 {{ manual_texts.study }}</h1>
    <p class="study-subtitle">{{ manual_texts.platform_description }}</p>
  </div>

  <!-- Study Mode Selection -->
  <div class="study-mode-section">
    <h2 class="section-title">{{ manual_texts.study_mode }}</h2>

    <div class="mode-options">
      <label class="mode-option">
        <input type="radio" name="study_mode" value="decks" checked>
        <div class="mode-card">
          <div class="mode-icon">📚</div>
          <div class="mode-content">
            <h3>{{ manual_texts.normal_study_by_decks }}</h3>
            <p>Học theo từng bộ thẻ cụ thể</p>
          </div>
        </div>
      </label>

      <label class="mode-option">
        <input type="radio" name="study_mode" value="random">
        <div class="mode-card">
          <div class="mode-icon">🎲</div>
          <div class="mode-content">
            <h3>{{ manual_texts.study_random_words }}</h3>
            <p>Học từ ngẫu nhiên từ tất cả bộ thẻ</p>
          </div>
        </div>
      </label>
    </div>
  </div>

  <!-- Deck Study Options -->
  <div id="deckStudyOptions" class="study-options-section">
    <h3 class="options-title">{{ manual_texts.select_decks }}</h3>

    <div class="deck-selector">
      <button id="deckDropdownToggle" class="dropdown-toggle">
        <span id="selectedDecksText">{{ manual_texts.no_decks_selected }}</span>
        <i class="fas fa-chevron-down dropdown-arrow"></i>
      </button>

      <div id="deckDropdown" class="dropdown-menu">
        {% for d in decks %}
          <label class="deck-option">
            <input type="checkbox" name="deck_ids" value="{{ d.id }}">
            <span class="deck-name">{{ d.name }}</span>
            <span class="deck-count">{{ d.flashcards.count }} từ</span>
          </label>
        {% empty %}
          <p class="no-decks-message">{{ manual_texts.no_decks_available }}</p>
        {% endfor %}
      </div>
    </div>

    <button id="startBtn" class="start-button">
      <span class="button-icon">🚀</span>
      {{ manual_texts.start_study }}
    </button>
  </div>

  <!-- Random Study Options -->
  <div id="randomStudyOptions" class="study-options-section hidden">
    <h3 class="options-title">{{ manual_texts.study_random_words }}</h3>

    <div class="random-options">
      <div class="word-count-input">
        <label for="randomWordCount">{{ manual_texts.number_of_words }}</label>
        <input type="number" id="randomWordCount" min="1" max="100" value="10">
      </div>

      <div class="available-words-info">
        <span class="info-label">{{ manual_texts.available_words }}:</span>
        <span id="totalWordsAvailable" class="info-value">{{ total_words_available }}</span>
      </div>
    </div>

    <button id="startRandomBtn" class="start-button">
      <span class="button-icon">🎲</span>
      {{ manual_texts.start_study }}
    </button>
  </div>

  <div id="studyArea" class="study-area">
    <div class="study-header-bar">
      <button id="backBtn" class="back-button">
        <i class="fas fa-arrow-left"></i>
        {{ manual_texts.back_to_selection }}
      </button>
      <div id="statsInfo" class="stats-display">
        {{ manual_texts.correct }}: 0 | {{ manual_texts.incorrect }}: 0
      </div>
    </div>

    <div id="cardBox" class="flashcard-container">
      <div class="card-header">
        <div class="word-section">
          <h2 id="cardWord" class="card-word"></h2>
          <button id="audioButton" class="audio-button" style="display:none;">
            <i class="fas fa-volume-up"></i>
          </button>
        </div>
        <p id="cardPhonetic" class="card-phonetic"></p>
      </div>

      <img id="cardImage" src="" alt="image" class="card-image" />

      <div id="answerSection" class="answer-section">
        <div id="cardDefs" class="card-definitions"></div>
        <div id="optionsArea" class="options-area"></div>
        <div id="feedbackMsg" class="feedback-message"></div>

        <div id="cambridgeLink" class="cambridge-link">
          <a id="cambridgeAnchor" href="" target="_blank">
            <i class="fas fa-external-link-alt"></i>
            {{ manual_texts.view_in_cambridge }}
          </a>
        </div>
      </div>

      <div id="gradeButtons" class="grade-buttons">
        <button class="grade-btn grade-again" data-grade="0">
          <span class="grade-icon">😰</span>
          {{ manual_texts.grade_again }}
        </button>
        <button class="grade-btn grade-hard" data-grade="1">
          <span class="grade-icon">😅</span>
          {{ manual_texts.grade_hard }}
        </button>
        <button class="grade-btn grade-good" data-grade="2">
          <span class="grade-icon">😊</span>
          {{ manual_texts.grade_good }}
        </button>
        <button class="grade-btn grade-easy" data-grade="3">
          <span class="grade-icon">😎</span>
          {{ manual_texts.grade_easy }}
        </button>
      </div>

      <p id="noCardMsg" class="no-cards-message">{{ manual_texts.no_cards_due }}</p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const STUDY_CFG = {
    nextUrl: "{% url 'api_next_question' %}",
    submitUrl: "{% url 'api_submit_answer' %}",
    csrfToken: document.querySelector('meta[name="csrf-token"]').content,
    labels: {
      correct: "{{ manual_texts.correct }}",
      incorrect: "{{ manual_texts.incorrect }}",
      check: "{{ manual_texts.check }}",
      placeholder: "{{ manual_texts.answer_placeholder }}",
      grade_again: "{{ manual_texts.grade_again }}",
      grade_hard: "{{ manual_texts.grade_hard }}",
      grade_good: "{{ manual_texts.grade_good }}",
      grade_easy: "{{ manual_texts.grade_easy }}",
      view_in_cambridge: "{{ manual_texts.view_in_cambridge }}",
      no_cards_due: "{{ manual_texts.no_cards_due }}",
      play_audio: "{{ manual_texts.play_audio }}",
      listen_and_type: "{{ manual_texts.listen_and_type }}",
      type_what_you_hear: "{{ manual_texts.type_what_you_hear }}",
      correct_answer: "{{ manual_texts.correct_answer }}",
      incorrect_answer: "{{ manual_texts.incorrect_answer }}"
    }
  };
</script>
<script src="{% static 'js/study.js' %}"></script>
{% endblock %}